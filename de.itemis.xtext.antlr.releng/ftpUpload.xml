<project default="upload" name="ftpUpload.xml">
	<target name="ftpUpload">
		<condition property="shouldUpload">
			<istrue value="${FTPUpload}" />
		</condition>
	</target>

	<target name="upload" depends="ftpUpload"  if="shouldUpload">
		<property file="${ftpProperties}" />

		<property name="ftpServerRoot" value="/home/ftp/download" />
		<property name="localRoot" value="${workspace}" />
		<echo>Local root: ${localRoot}</echo>
		<echo>FTP server root: ${ftpServerRoot}</echo>

		<property name="zipsSource" value="${localRoot}/promote/downloads" />
		<property name="updateSiteSource" value="${localRoot}/promote/updates/" />
		
		<!-- WARNING! Setup updateSiteTarget folder here:
			Milestones: ${ftpServerRoot}/updates/milestones/site
			Nightly: ${ftpServerRoot}/updates/nightly/site 
		 -->
		<property name="zipsTarget" value="${ftpServerRoot}/antlr/" />
		<property name="updateSiteTarget" value="${ftpServerRoot}/updates/nightly/site" />
	<!--	<property name="updateSiteTarget" value="${ftpServerRoot}/updates/milestones/site" />-->

		<echo>Removing existing nightly builds from ${zipsTarget}</echo>
		<ftp action="delete" verbose="false" server="ftp.itemis.de" port="21" remotedir="${zipsTarget}" userid="${ftpUser}" password="${ftpPassword}" passive="yes">
			<fileset includes="N*/**"/>
		</ftp>
		<ftp action="rmdir" verbose="true" server="ftp.itemis.de" port="21" remotedir="${zipsTarget}" userid="${ftpUser}" password="${ftpPassword}" passive="yes">
			<fileset includes="N*/**"/>
		</ftp>
		
		<echo>Uploading zips from ${zipsSource} to ${zipsTarget}</echo>
		<antcall target="uploadToItemisFtp">
			<param name="sourceDir" value="${zipsSource}" />
			<param name="targetDir" value="${zipsTarget}" />
		</antcall>


		<echo>Uploading updatesite from ${updateSiteSource} to ${updateSiteTarget}</echo>
		<antcall target="uploadToItemisFtp">
			<param name="sourceDir" value="${updateSiteSource}" />
			<param name="targetDir" value="${updateSiteTarget}" />
		</antcall>

	</target>

	<target name="uploadToItemisFtp">
		<ftp verbose="true" server="ftp.itemis.de" port="21" remotedir="${targetDir}" userid="${ftpUser}" password="${ftpPassword}" passive="yes">
			<fileset dir="${sourceDir}">
				<include name="**/*" />
			</fileset>
		</ftp>
	</target>
</project>